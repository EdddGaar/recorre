<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recorre | Cumplea√±os de la Semana</title>

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;800;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <!-- AOS -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

  <style>
    :root{
      /* Paleta pastel ampliada */
      --pink:#ffd1dc; --pink2:#ffc8dd; --rose:#ffb3c6; --coral:#ffd3ba;
      --blue:#bae1ff; --blue2:#cfe9ff; --mint:#c7f9cc; --lav:#e6d2ff; --lemon:#fff5a5;
      --ink:#0b102b; --ink2:#111742; --text:#ffffff; --muted:#e7edff;
      --glass: rgba(255,255,255,.12);
      --glass2: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.28);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: Inter, system-ui, sans-serif; color:var(--text);
      overflow-x:hidden; background:#111742;
    }

    /* Fondo AURORA pastel con blobs + grano sutil */
    .aurora{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(55vh 45vh at 15% 15%, #ffd1dc88, transparent 60%),
        radial-gradient(60vh 50vh at 85% 18%, #bae1ff88, transparent 60%),
        radial-gradient(70vh 55vh at 25% 80%, #c7f9cc88, transparent 60%),
        radial-gradient(60vh 55vh at 75% 78%, #e6d2ff88, transparent 60%),
        conic-gradient(from 180deg at 50% 50%, #141b37, #192245, #202a55, #141b37);
      filter: saturate(1.15) contrast(1.02);
      animation: auroraShift 24s ease-in-out infinite alternate;
    }
    @keyframes auroraShift{
      0%{ background-position: 0% 0%, 100% 0%, 20% 100%, 80% 100%, 50% 50%; filter:hue-rotate(0deg)}
      50%{ background-position: 4% -2%, 96% 2%, 24% 98%, 78% 96%, 50% 50%; filter:hue-rotate(6deg)}
      100%{ background-position: 8% -4%, 92% 4%, 28% 96%, 76% 92%, 50% 50%; filter:hue-rotate(10deg)}
    }

    /* Blobs con blur para efecto ne√≥n suave */
    .blobs{
      position:fixed; inset:0; pointer-events:none; z-index:-1;
      filter: blur(40px) saturate(1.2);
    }
    .blob{ position:absolute; border-radius:50%; opacity:.5; mix-blend-mode:screen;}
    .b1{ width:38vmax; height:38vmax; left:-10vmax; top:-8vmax; background:linear-gradient(135deg,var(--pink),var(--rose)); animation: float1 16s ease-in-out infinite alternate}
    .b2{ width:34vmax; height:34vmax; right:-8vmax; top:-6vmax;  background:linear-gradient(135deg,var(--blue),var(--blue2)); animation: float2 18s ease-in-out infinite alternate}
    .b3{ width:36vmax; height:36vmax; left:-6vmax; bottom:-10vmax;background:linear-gradient(135deg,var(--mint),var(--lemon)); animation: float3 20s ease-in-out infinite alternate}
    .b4{ width:30vmax; height:30vmax; right:-6vmax; bottom:-8vmax;background:linear-gradient(135deg,var(--lav),var(--pink2)); animation: float1 22s ease-in-out infinite alternate-reverse}
    @keyframes float1{ from{transform:translateY(-2%) translateX(0)} to{ transform:translateY(2%) translateX(2%)} }
    @keyframes float2{ from{transform:translateY(1%) translateX(-1%)} to{ transform:translateY(-2%) translateX(1%)} }
    @keyframes float3{ from{transform:translateY(0) translateX(1%)} to{ transform:translateY(3%) translateX(-1%)} }

    /* Grain sutil para textura */
    .grain{ position:fixed; inset:-10%; pointer-events:none; z-index:-1; opacity:.06; background-image:url('https://grainy-gradients.vercel.app/noise.svg'); background-size: 300px 300px; animation: grainMove 6s steps(6) infinite }
    @keyframes grainMove{ to{ transform:translate3d(-10%, 10%, 0)} }

    header{ text-align:center; padding:28px 18px 8px; }
    .logo{
      width:140px; height:140px; border-radius:50%; object-fit:cover;
      border:2px solid rgba(255,255,255,.7);
      box-shadow:0 0 50px rgba(255,209,220,.45), 0 0 90px rgba(186,225,255,.35);
      margin-bottom:12px;
      background:linear-gradient(145deg, rgba(255,255,255,.18), rgba(255,255,255,.05));
    }
    .brand{font-family:Outfit; font-weight:900; font-size:clamp(28px,4.4vw,52px);
      background:linear-gradient(90deg,var(--pink),var(--lemon),var(--blue),var(--lav));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow:0 2px 8px rgba(0,0,0,.35);
    }

    main{max-width:960px; margin:0 auto 86px; padding:0 18px}
    .phrase{
      text-align:center; margin:10px auto 24px; max-width:860px;
      font-size:clamp(16px,2.4vw,20px); color:var(--muted);
      background:linear-gradient(90deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.22);
      border-radius:16px; padding:12px 16px; backdrop-filter: blur(10px);
    }

    .toolbar{
      display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap; margin:8px 0 18px;
    }
    .btn{
      appearance:none; border:none; border-radius:999px; padding:10px 16px; cursor:pointer; color:#111; font-weight:700;
      background:linear-gradient(180deg, #fff, #f0f0ff);
      box-shadow:0 8px 24px rgba(0,0,0,.25), inset 0 1px 0 #fff;
      transition: transform .15s ease, box-shadow .15s ease; font-family:Inter;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow:0 12px 30px rgba(0,0,0,.32), inset 0 1px 0 #fff }
    .btn:active{ transform: translateY(0) scale(.98) }
    .btn-ghost{ background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.10)); color:#fff; border:1px solid rgba(255,255,255,.24) }

    .section{
      display:block; margin:24px auto; padding:16px;
      background:linear-gradient(180deg, var(--glass), var(--glass2));
      border:1px solid var(--border);
      border-radius:22px; backdrop-filter: blur(14px);
      box-shadow:0 10px 36px rgba(0,0,0,.35);
    }
    .title-day{
      text-align:center; font-family:Outfit; font-weight:900; letter-spacing:.5px; margin:0 0 14px;
      font-size:clamp(28px,6.5vw,64px); line-height:1.05;
      text-shadow:0 2px 0 rgba(0,0,0,.28), 0 10px 30px rgba(0,0,0,.35);
    }
    .title-day.small{ font-size:clamp(22px,4.6vw,40px) }

    .cards{ display:grid; grid-template-columns:1fr; gap:14px; max-width:760px; margin:0 auto; }
    .card{
      position:relative; text-align:center; padding:18px 16px; border-radius:18px;
      background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.28); box-shadow:0 6px 28px rgba(0,0,0,.28);
      transition:transform .18s ease, box-shadow .18s ease; overflow:hidden;
    }
    .card:hover{ transform: translateY(-2px); box-shadow:0 12px 36px rgba(0,0,0,.34) }
    .card::before{content:"üéÇ"; position:absolute; left:10px; top:10px; font-size:18px}
    .name{font-family:Outfit; font-weight:900; font-size:clamp(18px,3.5vw,24px); margin:0 0 6px}
    .meta{font-size:14px; opacity:.9; margin:0 0 8px}
    .wish{font-size:15px; color:var(--muted); margin:0}

    .badge{ position:absolute; right:10px; top:10px; font-size:12px; padding:.2rem .5rem; border-radius:999px; background:linear-gradient(90deg,var(--lemon),var(--pink)); color:#111; font-weight:800; box-shadow:0 6px 16px rgba(0,0,0,.2)}

    footer{text-align:center; padding:26px 16px; color:var(--muted)}

    /* Confeti */
    .confetti{ position:fixed; top:-10px; width:8px; height:14px; z-index:5; opacity:.98; border-radius:2px; pointer-events:none; animation:fall linear forwards; will-change: transform, opacity; filter: drop-shadow(0 2px 2px rgba(0,0,0,.12)); mix-blend-mode: screen; }
    @keyframes fall{to{ transform:translateY(110vh) rotate(540deg); opacity:1 }}

    /* Responsive */
    @media (min-width:720px){ .cards{ grid-template-columns:repeat(2,1fr) } }
    @media (prefers-reduced-motion: reduce){ .confetti{animation-duration:0s !important} *{animation:none !important; transition:none !important} }
  </style>
</head>
<body>
  <div class="aurora"></div>
  <div class="blobs">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="blob b4"></div>
  </div>
  <div class="grain"></div>

  <header>
    <img class="logo" src="https://github.com/EdddGaar/recorre/raw/main/Re%20corre%20Logo.jpg" alt="Logo Recorre" />
    <div class="brand">Recorre</div>
  </header>

  <main>
    <p class="phrase" id="global-phrase">Que este nuevo a√±o te traiga kil√≥metros, salud y muchas metas logradas. ¬°Te celebra la familia Recorre! üéΩ‚ú®</p>

    <div class="toolbar">
      <button class="btn" id="btn-celebrate">üéâ Celebrar</button>
      <button class="btn btn-ghost" id="btn-hoy">Ir a HOY</button>
      <button class="btn btn-ghost" id="btn-refetch">Recargar datos</button>
    </div>

    <div id="vertical"></div>
  </main>

  <footer>#RecorreToluca üéΩüî•üåÑ ¬∑ Creado de Runners para Runners ‚ù§Ô∏è ¬∑ <span id="week-range"></span></footer>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    // ========= CONFIG =========
    // 1) PUBLICA tu Google Sheet como CSV (Archivo > Compartir > Publicar en la Web) y pega la URL aqu√≠
    //    o usa un CSV est√°tico hosteado (GitHub raw, etc.)
    const CONFIG = {
      CSV_URL: null, // ej.: "https://docs.google.com/spreadsheets/d/e/XXX/pub?output=csv"
      TIMEZONE: 'America/Mexico_City',
      FALLBACK_WISH: 'Que este nuevo a√±o te traiga kil√≥metros, salud y muchas metas logradas. ¬°Te celebra la familia Recorre! üéΩ‚ú®',
    };

    // ========= DATOS local (fallback) =========
    const FALLBACK_BIRTHDAYS = [
      { name: "Fernanda S√°nchez",  date: "08-17", pace:"5:15/km" },
      { name: "Luis Hern√°ndez",    date: "08-17", pace:"5:00/km" },
      { name: "Ana G√≥mez",         date: "08-18", pace:"6:05/km" },
      { name: "Jorge P√©rez",       date: "08-20", pace:"4:55/km" },
      { name: "Mar√≠a L√≥pez",       date: "08-21", pace:"5:40/km" },
      { name: "Carlos Ram√≠rez",    date: "08-22", pace:"5:20/km" },
      { name: "Paola Ortega",      date: "08-23", pace:"5:50/km" },
    ];

    // ========= UTILIDADES FECHA =========
    const dayNames = ['Domingo','Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado'];
    const fmtDayMonth = (d)=> d.toLocaleDateString('es-MX', { day:'2-digit', month:'short', timeZone: CONFIG.TIMEZONE }).replace('.', '');

    const at0 = d=>{ const x=new Date(d); x.setHours(0,0,0,0); return x };
    function mondayOfWeek(d){ const x=at0(d); const w=x.getDay(); const diff=(w===0?-6:1-w); x.setDate(x.getDate()+diff); return x }
    function sundayOfWeek(d){ const m=mondayOfWeek(d); const s=new Date(m); s.setDate(m.getDate()+6); return s }
    function parseMD(md, year){ const [m, d]=md.split('-').map(Number); return new Date(year, m-1, d) }
    const isSameDay = (a,b)=> at0(a).getTime()===at0(b).getTime();

    // ========= CARGA CSV (opcional) =========
    async function loadBirthdays(){
      if(!CONFIG.CSV_URL){ return FALLBACK_BIRTHDAYS }
      return new Promise((resolve)=>{
        Papa.parse(CONFIG.CSV_URL, {
          download: true,
          header: true,
          complete: (res)=>{
            const rows = res.data.filter(r=> r && (r.name || r.Nombre));
            const mapped = rows.map(r=>({
              name: r.name || r.Nombre || r.NombreCompleto || 'Runner',
              date: (r.date || r.Fecha || '').trim(), // Formato esperado: MM-DD
              pace: r.pace || r.Ritmo || r.Pace || 'Runner',
              wish: r.wish || r.Mensaje || r.Deseo || ''
            })).filter(x=> /^\d{2}-\d{2}$/.test(x.date));
            resolve(mapped.length? mapped : FALLBACK_BIRTHDAYS);
          },
          error: ()=> resolve(FALLBACK_BIRTHDAYS)
        });
      });
    }

    // ========= L√ìGICA - agrupar por semana =========
    function groupByWeek(list){
      const today = new Date();
      const start = mondayOfWeek(today), end = sundayOfWeek(today);

      // Mostrar rango de semana en el footer
      document.getElementById('week-range').textContent = `${fmtDayMonth(start)} ‚Äì ${fmtDayMonth(end)}`;

      // Crear semillas (Lun->Dom)
      const days = []; for(let i=0;i<7;i++){ const d=new Date(start); d.setDate(start.getDate()+i); days.push(d) }

      const year = today.getFullYear();
      const map = new Map(days.map(d=>[at0(d).getTime(), []]));

      for(const p of list){
        // Soporte para 29/02: si no existe, cae 28/02 ese a√±o
        let dt = parseMD(p.date, year);
        if(dt.getMonth()===1 && dt.getDate()===29 && Number.isNaN(dt.getTime())){
          dt = new Date(year, 1, 28);
        }
        if(at0(dt) >= at0(start) && at0(dt) <= at0(end)){
          map.get(at0(dt).getTime()).push(p);
        }
      }

      const out = []; const tomorrow = new Date(today); tomorrow.setDate(today.getDate()+1);
      for(const d of days){
        const label = isSameDay(d,today) ? 'HOY' : isSameDay(d,tomorrow) ? 'Ma√±ana' : dayNames[d.getDay()];
        out.push({ label, date:d, items: map.get(at0(d).getTime())||[] });
      }
      out.sort((a,b)=>{ const rank = v => v.label==='HOY' ? 0 : v.label==='Ma√±ana' ? 1 : 2; return rank(a)-rank(b) || a.date-b.date });
      return out;
    }

    // ========= RENDER =========
    function renderBlocks(blocks){
      const container = document.getElementById('vertical');
      container.innerHTML = '';
      blocks.forEach((g, idx)=>{
        const section = document.createElement('section');
        section.className = 'section'; section.setAttribute('data-aos', 'fade-up');
        if(idx>0) section.setAttribute('data-aos-delay', String(80*idx));

        const h = document.createElement('h2');
        h.className = 'title-day' + (g.label==='HOY' ? '' : ' small');
        h.textContent = g.label; section.appendChild(h);

        const cards = document.createElement('div');
        cards.className = 'cards';

        if(!g.items.length){
          const empty = document.createElement('div'); empty.className = 'card';
          const p = document.createElement('p'); p.className = 'wish'; p.textContent = '‚Äî Sin cumplea√±er@s ‚Äî';
          empty.appendChild(p); cards.appendChild(empty);
        } else {
          g.items.sort((a,b)=> a.name.localeCompare(b.name)).forEach(p=>{
            const c = document.createElement('div'); c.className='card';
            const n = document.createElement('p'); n.className='name'; n.textContent=p.name;
            const m = document.createElement('p'); m.className='meta'; m.textContent = `${fmtDayMonth(g.date)} ¬∑ ${p.pace||'Runner'}`;
            const w = document.createElement('p'); w.className='wish'; w.textContent=p.wish || CONFIG.FALLBACK_WISH;
            const badge = document.createElement('span'); badge.className='badge'; badge.textContent='üéΩ Recorre';
            c.appendChild(badge); c.appendChild(n); c.appendChild(m); c.appendChild(w); cards.appendChild(c);
          });
        }
        section.appendChild(cards); container.appendChild(section);
      });
    }

    // ========= EFECTOS =========
    AOS.init({ once:true });

    particlesJS('vertical', { // fondo de part√≠culas sutil tras las cards
      particles: { number:{value:45}, color:{value:['#ffd1dc','#ffc8dd','#bae1ff','#cfe9ff','#c7f9cc','#e6d2ff']}, opacity:{ value:0.6, random:true }, size:{value:2.8, random:true}, move:{enable:true,speed:0.8,random:true} },
      interactivity:{ events:{ onhover:{enable:true,mode:'repulse'} } }, retina_detect: true
    });

    const CONFETTI_COLORS = ['#ffd1dc','#ffc8dd','#bae1ff','#cfe9ff','#c7f9cc','#e6d2ff','#fff5a5'];
    const CONFETTI_SHAPES = ['rect','circle','tilt','star'];
    function confettiBurst(n=220, dur=[1.9,3.2]){
      for(let i=0;i<n;i++){
        const el = document.createElement('span'); el.className = 'confetti';
        el.style.left = (Math.random()*100)+'vw'; el.style.background = CONFETTI_COLORS[(Math.random()*CONFETTI_COLORS.length)|0];
        const shape = CONFETTI_SHAPES[(Math.random()*CONFETTI_SHAPES.length)|0];
        if(shape==='circle'){ const d = 5 + Math.random()*7; el.style.width=d+'px'; el.style.height=d+'px'; el.style.borderRadius='50%'; }
        else if(shape==='tilt'){ const w = 7 + Math.random()*9, h = 9 + Math.random()*11; el.style.width=w+'px'; el.style.height=h+'px'; el.style.transform=`rotate(${Math.random()*360}deg) skew(${10+Math.random()*20}deg)`; }
        else if(shape==='star'){ el.style.width='0'; el.style.height='0'; el.style.borderLeft='6px solid transparent'; el.style.borderRight='6px solid transparent'; el.style.borderBottom=`10px solid ${CONFETTI_COLORS[(Math.random()*CONFETTI_COLORS.length)|0]}`; el.style.background='transparent' }
        else{ el.style.width=(6+Math.random()*6)+'px'; el.style.height=(10+Math.random()*10)+'px'; el.style.borderRadius='2px'; }
        const t = dur[0] + Math.random()*(dur[1]-dur[0]); el.style.animationDuration = t+'s';
        document.body.appendChild(el); setTimeout(()=>el.remove(), t*1000 + 1200);
      }
    }

    function startConfettiLoop(){
      confettiBurst(240, [1.8, 2.8]);
      const id = setInterval(()=>confettiBurst(120, [2.0, 3.2]), 3500);
      setTimeout(()=> clearInterval(id), 12000); // no saturar
    }

    // ========= INIT =========
    async function init(){
      const data = await loadBirthdays();
      const blocks = groupByWeek(data);
      renderBlocks(blocks);

      // Scroll a HOY si existe
      const hoy = [...document.querySelectorAll('.title-day')].find(n=> n.textContent.trim()==='HOY');
      if(hoy){ hoy.scrollIntoView({behavior:'smooth', block:'start'}) }
    }

    init();

    // ========= Acciones UI =========
    document.getElementById('btn-celebrate').addEventListener('click', ()=> startConfettiLoop());
    document.getElementById('btn-hoy').addEventListener('click', ()=>{
      const hoy = [...document.querySelectorAll('.title-day')].find(n=> n.textContent.trim()==='HOY');
      if(hoy){ hoy.scrollIntoView({behavior:'smooth', block:'start'}) }
    });
    document.getElementById('btn-refetch').addEventListener('click', ()=> init());

    // ========= Actualizaci√≥n autom√°tica a la semana siguiente =========
    // Checa a medianoche local MX y recarga para mostrar la semana correcta
    function scheduleMidnightReload(){
      const now = new Date();
      const midnight = new Date(now); midnight.setHours(24,0,0,0);
      const ms = midnight.getTime() - now.getTime();
      setTimeout(()=>{ init(); scheduleMidnightReload(); }, Math.max(1000, ms));
    }
    scheduleMidnightReload();
  </script>
</body>
</html>
