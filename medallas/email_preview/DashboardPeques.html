<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Panel Tu Peque Recorre 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0c001a, #1a002e);
    color: #fff;
    text-align: center;
    overflow-x: hidden;
    min-height: 100vh;
  }

  #particles-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: -1;
    opacity: 0.7;
  }

  .container {
    max-width: 1300px;
    margin: auto;
    padding: 25px;
    position: relative;
    z-index: 2;
  }

  h1 {
    color: #FFD54F;
    font-weight: 800;
    font-size: 2.8em;
    margin-bottom: 10px;
    text-shadow: 0 0 15px rgba(255,213,79,0.6);
    background: linear-gradient(to right, #FFD54F, #FFA000);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  p {
    color: #ccc;
    font-size: 1em;
    margin-bottom: 25px;
  }

  /* ‚ú® Tarjetas principales con efecto dorado */
  .stats {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 25px;
    margin-bottom: 40px;
  }

  .stat-card {
    background: rgba(28, 1, 51, 0.6);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    padding: 22px 28px;
    min-width: 160px;
    border: 1px solid rgba(255, 213, 79, 0.2);
    position: relative;
    overflow: hidden;
    opacity: 0;
    transform: translateY(25px);
    transition: all 0.6s ease;
  }

  .stat-card.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: -2px; left: -2px; right: -2px; bottom: -2px;
    background: linear-gradient(45deg, #FFD54F, #FFA000, #FFD54F);
    border-radius: 22px;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .stat-card:hover::before { opacity: 1; }

  .stat-card:hover {
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 15px 35px rgba(255, 213, 79, 0.4);
    background: rgba(35, 2, 65, 0.8);
  }

  .stat-card h3 {
    color: #FFD54F;
    font-size: 1.2em;
    font-weight: 600;
    margin-bottom: 10px;
  }

  .stat-card p {
    font-size: 1.7em;
    font-weight: 800;
    text-shadow: 0 0 10px rgba(255,213,79,0.3);
  }

  /* üìà Gr√°ficos */
  .charts {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 35px;
  }

  .chart-card {
    background: rgba(28, 1, 51, 0.6);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 25px;
    width: 380px;
    border: 1px solid rgba(255, 213, 79, 0.15);
    transition: all 0.4s ease;
    opacity: 0;
    transform: scale(0.95);
  }

  .chart-card.visible {
    opacity: 1;
    transform: scale(1);
  }

  .chart-card:hover {
    transform: scale(1.03);
    box-shadow: 0 12px 30px rgba(255,213,79,0.35);
    background: rgba(35,2,65,0.8);
  }

  canvas {
    width: 100% !important;
    height: 260px !important;
  }

  #lastUpdate {
    margin-top: 25px;
    font-size: 0.9em;
    color: #aaa;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.6s ease;
  }

  #lastUpdate.visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (max-width: 768px) {
    .stats, .charts { flex-direction: column; align-items: center; }
    .chart-card, .stat-card { width: 90%; }
  }
</style>
</head>
<body>
<canvas id="particles-canvas"></canvas>

<div class="container">
  <h1>üèÉ‚Äç‚ôÄÔ∏è Tu Peque Recorre 2025</h1>
  <p>Panel en vivo ‚Äî actualizaci√≥n autom√°tica cada 3 minutos</p>

  <div class="stats">
    <div class="stat-card"><h3>üë¶ Ni√±os</h3><p id="countNinos">--</p></div>
    <div class="stat-card"><h3>üëß Ni√±as</h3><p id="countNinas">--</p></div>
    <div class="stat-card"><h3>‚ôø Participantes inclusivos</h3><p id="countCapDif">--</p></div>
    <div class="stat-card"><h3>üèÖ Reconocimientos enviados</h3><p id="countReconocimientos">--</p></div>
  </div>

  <div class="charts">
    <div class="chart-card"><h3>Evoluci√≥n de Inscritos</h3><canvas id="totalChart"></canvas></div>
    <div class="chart-card"><h3>Distribuci√≥n por G√©nero</h3><canvas id="generoChart"></canvas></div>
    <div class="chart-card"><h3>üèÖ Progreso de Reconocimientos</h3><canvas id="reconoChart"></canvas></div>
  </div>

  <p id="lastUpdate">√öltima actualizaci√≥n: --</p>
</div>

<script>
// üåü Fondo de part√≠culas doradas
const canvas = document.getElementById('particles-canvas');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth; canvas.height = innerHeight;
addEventListener('resize', ()=>{canvas.width=innerWidth;canvas.height=innerHeight;});
class Particle {
  constructor(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.size=Math.random()*3+1;this.speedX=Math.random()-0.5;this.speedY=Math.random()-0.5;this.color=`rgba(255,${150+Math.random()*100},${Math.random()*50},${Math.random()*0.4})`;}
  update(){this.x+=this.speedX;this.y+=this.speedY;if(this.x<0||this.x>canvas.width||this.y<0||this.y>canvas.height){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;}}
  draw(){ctx.fillStyle=this.color;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();}
}
const particles=Array.from({length:50},()=>new Particle());
(function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);particles.forEach(p=>{p.update();p.draw();});requestAnimationFrame(animate);})();

// üìä Configuraci√≥n de datos
const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vRZO2qvxTwuib5-PUJT28eWfGqftGIn-5pt4e1yh9C0LKEgJAV8u7gmmHpcOjJZKQzd1D8yrrqlFZVb/pub?gid=1619875874&single=true&output=csv";
const proxiedUrl=`https://api.allorigins.win/raw?url=${encodeURIComponent(csvUrl)}`;

let totalChart,generoChart,reconoChart;
const nombresFemeninos=["ana","maria","sofia","valentina","camila","isabella","paula","diana","samantha","lucia","andrea","carla","elena","renata","julieta","mariana","martina","salome","emilia","alexa","natalia","jazmin","eva","bianca","zaira"];

async function fetchSheetData(){
  try{
    const res=await fetch(proxiedUrl);
    const text=await res.text();
    const rows=text.split("\n").map(r=>r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/(^"|"$)/g,'')));
    const headers=rows[0]; const data=rows.slice(1).filter(r=>r.length>1);
    const iCat=headers.findIndex(h=>h.toLowerCase().includes('categor'));
    const iFecha=headers.findIndex(h=>h.toLowerCase().includes('fecha'));
    const iNombre=headers.findIndex(h=>h.toLowerCase().includes('nombre del menor'));
    const iCapDif=headers.findIndex(h=>h.toLowerCase().includes('capacidad diferente'));
    const iRecono=headers.findIndex(h=>h.toLowerCase().includes('reconocimiento'));
    const total=data.length;
    const categorias=['4 a 6','7 a 9','10 a 12','13 a 15'];
    const inscritosPorCategoria=categorias.map(cat=>data.filter(r=>r[iCat]?.includes(cat)).length);
    const ninos=data.filter(r=>{const n=r[iNombre]?.toLowerCase().trim()||"";return !nombresFemeninos.some(f=>n.includes(f))&&!n.endsWith("a");}).length;
    const ninas=data.filter(r=>{const n=r[iNombre]?.toLowerCase().trim()||"";return nombresFemeninos.some(f=>n.includes(f))||n.endsWith("a");}).length;
    const capDif=iCapDif===-1?0:data.filter(r=>r[iCapDif]?.toLowerCase().includes('si')).length;
    const reconocimientos=iRecono===-1?0:data.filter(r=>r[iRecono]&&r[iRecono].trim()!=="").length;
    const fechas={};
    data.forEach(r=>{const f=r[iFecha]?new Date(r[iFecha]).toLocaleDateString('es-MX'):null;if(f)fechas[f]=(fechas[f]||0)+1;});
    const fechasOrdenadas=Object.keys(fechas).sort((a,b)=>new Date(a)-new Date(b));
    let acumulado=0; const inscritosPorDia=fechasOrdenadas.map(f=>acumulado+=fechas[f]);
    updateDashboard({total,fechasOrdenadas,inscritosPorDia,ninos,ninas,capDif,reconocimientos});
  }catch(e){console.error(e);}
}

function updateDashboard(data){
  document.getElementById("countNinos").textContent=data.ninos;
  document.getElementById("countNinas").textContent=data.ninas;
  document.getElementById("countCapDif").textContent=data.capDif;
  document.getElementById("countReconocimientos").textContent=data.reconocimientos;
  document.getElementById("lastUpdate").textContent='√öltima actualizaci√≥n: '+new Date().toLocaleTimeString('es-MX');
  document.getElementById("lastUpdate").classList.add("visible");

  document.querySelectorAll('.stat-card,.chart-card').forEach((c,i)=>{
    setTimeout(()=>c.classList.add('visible'),200+i*150);
  });

  if(totalChart) totalChart.destroy();
  if(generoChart) generoChart.destroy();
  if(reconoChart) reconoChart.destroy();

  totalChart=new Chart(document.getElementById('totalChart'),{
    type:'line',
    data:{labels:data.fechasOrdenadas,datasets:[{label:'Inscritos acumulados',data:data.inscritosPorDia,borderColor:'#FFD54F',backgroundColor:'rgba(255,213,79,0.25)',fill:true,tension:0.4,pointRadius:4,pointBackgroundColor:'#fff'}]},
    options:{plugins:{legend:{display:false},title:{display:true,text:`${data.total} participantes totales`,color:'#FFD54F',font:{size:16,weight:'bold'}}},scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'},beginAtZero:true}}}
  });

  generoChart=new Chart(document.getElementById('generoChart'),{
    type:'pie',
    data:{labels:['Ni√±os','Ni√±as'],datasets:[{data:[data.ninos,data.ninas],backgroundColor:['#4FC3F7','#E91E63']}]},
    options:{plugins:{legend:{labels:{color:'#fff'}},title:{display:true,text:'Distribuci√≥n por G√©nero',color:'#FFD54F'}}}
  });

  const progreso=(data.reconocimientos/data.total)*100;
  reconoChart=new Chart(document.getElementById('reconoChart'),{
    type:'doughnut',
    data:{labels:['Enviados','Pendientes'],datasets:[{data:[data.reconocimientos,data.total-data.reconocimientos],backgroundColor:['#FFD54F','#333'],borderWidth:0}]},
    options:{cutout:'70%',plugins:{legend:{display:false},title:{display:true,text:`${progreso.toFixed(1)}% enviados`,color:'#FFD54F'}}}
  });
}

fetchSheetData();
setInterval(fetchSheetData,180000);
</script>
</body>
</html>
