<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Panel Re-corre Running Club</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root {
    --gold: #F9A825;
    --bg1: #0f0120;
    --bg2: #1b0033;
    --card-bg: rgba(17, 0, 34, 0.7);
  }
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 20px;
    text-align: center;
    color: #fff;
    background: linear-gradient(120deg, var(--bg1), var(--bg2));
    background-size: 200% 200%;
    animation: gradientShift 10s ease infinite;
    height: 100vh;
    overflow: hidden;
  }
  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  h1 {
    font-size: 1.8em;
    margin: 0;
    color: var(--gold);
    text-shadow: 0 0 10px var(--gold);
  }
  .subtitle {
    font-size: 0.9em;
    color: #ccc;
    margin-bottom: 16px;
  }

  .dashboard {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    gap: 20px;
    height: calc(100vh - 120px);
  }

  .charts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    width: 90%;
    max-width: 900px;
  }

  .chart-card {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 0 12px rgba(249,168,37,0.25);
    backdrop-filter: blur(6px);
  }

  canvas {
    width: 100%;
    height: 260px;
  }

  #lastUpdate {
    margin-top: 12px;
    font-size: 0.8em;
    color: #aaa;
  }

  @media (max-width: 768px) {
    .charts { grid-template-columns: 1fr; width: 100%; }
    canvas { height: 220px; }
  }
</style>
</head>
<body>
<h1>üèÉ‚Äç‚ôÄÔ∏è Tu Peque Recorre 2025</h1>
<p class="subtitle">Panel en vivo ‚Äî actualizaci√≥n autom√°tica cada 3 minutos</p>

<div class="dashboard">
  <div class="charts">
    <div class="chart-card">
      <canvas id="totalChart"></canvas>
    </div>
    <div class="chart-card">
      <canvas id="categoriaChart"></canvas>
    </div>
  </div>
</div>

<p id="lastUpdate">√öltima actualizaci√≥n: --</p>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZO2qvxTwuib5-PUJT28eWfGqftGIn-5pt4e1yh9C0LKEgJAV8u7gmmHpcOjJZKQzd1D8yrrqlFZVb/pub?gid=1619875874&single=true&output=csv";
const proxiedUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(csvUrl)}`;

let totalChart, categoriaChart;

async function fetchSheetData(){
 try {
   const res = await fetch(proxiedUrl);
   const text = await res.text();
   const rows = text.split("\n").map(r => r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c => c.replace(/(^"|"$)/g,'')));
   const headers = rows[0];
   const data = rows.slice(1).filter(r => r.length > 1);

   const iCat = headers.findIndex(h => h.includes('Categor√≠a'));
   const total = data.length;
   const categorias = ['4 a 6', '7 a 9', '10 a 12', '13 a 15'];
   const inscritosPorCategoria = categorias.map(cat => data.filter(r => r[iCat]?.includes(cat)).length);

   updateDashboard({ total, categorias, inscritosPorCategoria });
 } catch (err) {
   console.error("‚ùå Error al leer hoja:", err);
 }
}

function updateDashboard(data){
 document.getElementById('lastUpdate').textContent =
   '√öltima actualizaci√≥n: ' + new Date().toLocaleTimeString('es-MX');

 if (totalChart) totalChart.destroy();
 if (categoriaChart) categoriaChart.destroy();

 totalChart = new Chart(document.getElementById('totalChart'), {
   type: 'doughnut',
   data: {
     labels: ['Inscritos', 'Restante (meta 250)'],
     datasets: [{
       data: [data.total, 250 - data.total],
       backgroundColor: ['#F9A825', '#3a2b52'],
       borderWidth: 0
     }]
   },
   options: {
     cutout: '70%',
     plugins: {
       legend: { display: false },
       tooltip: { enabled: false },
       title: {
         display: true,
         text: `${data.total} Inscritos`,
         color: '#fff',
         font: { size: 18 }
       }
     }
   }
 });

 categoriaChart = new Chart(document.getElementById('categoriaChart'), {
   type: 'bar',
   data: {
     labels: data.categorias,
     datasets: [{
       label: 'Inscritos por categor√≠a',
       data: data.inscritosPorCategoria,
       backgroundColor: ['#00e676','#ffeb3b','#ff9800','#f44336']
     }]
   },
   options: {
     plugins: { legend: { display: false } },
     scales: {
       x: { ticks: { color: '#fff' } },
       y: { ticks: { color: '#fff' }, beginAtZero: true }
     }
   }
 });
}

fetchSheetData();
setInterval(fetchSheetData, 180000);
</script>
</body>
</html>
